# TSTK-TL6TN9

Generated by [Auto-Keyboard-Design-Kit](https://auto-kdk.pages.dev/)

## Preview

- 3D View

![Case Preview](images/TSTK-TL6TN9-case-preview.png)

- Top View

![Top View](images/TSTK-TL6TN9-top-view.png)

## Parts List

|Part|Quantity|
|---|---|
|wireless controller|2|
|Conthrough(2.5mm, 9pin)|4|
|Battery|2|
USB-C cable|1|
|MX switch and MX socket|58|
|Choc V2 switch and Choc socket|8|
|Diode|66|
|Keycap|66|

## 機能

### PAW3222 トラックボール対応

このキーボードは右手側にPAW3222トラックボールを搭載し、高度な電源管理機能を備えています：

#### 🔋 電源管理
- **アイドルタイムアウト**: 5秒間操作がないと自動的にスリープモードに移行
- **スキャン頻度削減**: 非アクティブ時の消費電力を削減  
- **パワーコントロール**: ハードウェアレベルでのセンサーのスリープ/ウェイク制御

#### ⚙️ 設定オプション

以下の設定オプションが `boards/shields/tstk_tl6tn9/tstk_tl6tn9_right.conf` で利用可能です：

```properties
# PAW3222 アイドル・電源管理
CONFIG_PAW3222_IDLE_TIMEOUT_SECONDS=5     # アイドルタイムアウト（秒）
CONFIG_PAW3222_REDUCED_SCAN=y             # スキャン頻度削減を有効化
CONFIG_PAW3222_REDUCED_SCAN_MS=100        # 削減モード時のスキャン間隔（ミリ秒）
CONFIG_PAW3222_POWER_CTRL=y               # ハードウェア電源制御を有効化
```

#### 📊 デフォルト設定

| 設定項目 | 値 | 説明 |
|---------|-------|-------------|
| `IDLE_TIMEOUT_SECONDS` | 5 | アイドルモード移行までの時間 |
| `REDUCED_SCAN` | 有効 | モーションタイマーの最適化 |
| `REDUCED_SCAN_MS` | 100ms | スキャン頻度削減時のポーリング間隔 |
| `POWER_CTRL` | 有効 | ハードウェアスリープ/ウェイク制御 |

#### 🔧 カスタマイズ

電源管理の動作を変更するには：

1. `boards/shields/tstk_tl6tn9/tstk_tl6tn9_right.conf` を編集
2. CONFIG値を好みに応じて調整
3. `west build` でファームウェアを再ビルド

**バッテリー持続時間重視の設定例:**
```properties
CONFIG_PAW3222_IDLE_TIMEOUT_SECONDS=10    # より長いアイドルタイムアウト
CONFIG_PAW3222_REDUCED_SCAN_MS=200        # より遅いスキャン
```

**最大応答性重視の設定例:**
```properties
CONFIG_PAW3222_IDLE_TIMEOUT_SECONDS=30    # 最小限のアイドルタイムアウト
CONFIG_PAW3222_REDUCED_SCAN_MS=50         # より高速なスキャン
```

## ビルド方法

このファームウェアはwest ビルドシステムを使用するZMKとカスタムPAW3222ドライバーを使用しています。

### 前提条件
- West ビルド環境
- ZMK 開発環境のセットアップ

### ビルドコマンド
```bash
# 左手側ファームウェアのビルド
west build -b akdk_bt1 -- -DSHIELD=tstk_tl6tn9_left

# 右手側ファームウェアのビルド
west build -b akdk_bt1 -- -DSHIELD=tstk_tl6tn9_right

# 設定リセット用ファームウェア
west build -b akdk_bt1 -- -DSHIELD=settings_reset
```

### CI/CD
GitHub Actionsが push/PR 時に自動的にファームウェアをビルドします：
- 左手側: `tstk_tl6tn9_left-akdk_bt1-zmk.uf2`
- 右手側: `tstk_tl6tn9_right-akdk_bt1-zmk.uf2`  
- 設定リセット: `settings_reset-akdk_bt1-zmk.uf2`

## トラブルシューティング

### PAW3222 電源管理

**問題: アイドル後にトラックボールが反応しない**
- `CONFIG_PAW3222_POWER_CTRL=y` が有効になっているか確認
- アイドルタイムアウト設定を確認
- 電源状態の切り替えログを監視

**問題: バッテリー消耗が激しい**
- `CONFIG_PAW3222_IDLE_TIMEOUT_SECONDS` を増やす
- `CONFIG_PAW3222_REDUCED_SCAN_MS` を増やす
- `CONFIG_PAW3222_REDUCED_SCAN=y` が有効か確認

**問題: トラックボールの応答が遅い**
- `CONFIG_PAW3222_REDUCED_SCAN_MS` を減らす
- `CONFIG_PAW3222_IDLE_TIMEOUT_SECONDS` を減らす

### デバッグ
.conf` ファイルでデバッグログを有効化：

注: このリポジトリではログ設定は共通設定ファイル `config/prj.conf` に集約されています。個別のシールド設定（`boards/shields/.../*.conf`）で上書きすることも可能ですが、基本は `config/prj.conf` を編集してください。

```properties
# 有効にする場合（例）
CONFIG_ZMK_LOG_LEVEL_DBG=y
CONFIG_ZMK_USB_LOGGING=y
```

PAW3222関連のログメッセージを確認：
- `PAW32XX: idle timeout reached, entering idle`
- `PAW32XX: motion detected while idle -> waking up`
- `PAW32XX: sensor set to sleep`
- `PAW32XX: sensor wake request succeeded`

## ライセンス

[ライセンス情報をここに記載]
